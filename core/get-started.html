<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Acme PHP | Documentation</title>

    <link href="/fonts/fonts.css" rel="stylesheet">
    <link href="/icons/css/font-awesome.min.css" rel="stylesheet">
    <link href="/min/app.css" rel="stylesheet">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<header class="header">
    <div class="container">
        <h1 class="header-title">
            <a href="/">Acme PHP</a>
        </h1>

        <nav class="header-menu">
            <ul>
                <li class="current">
                    <a href="/documentation/">
                        Documentation
                    </a>
                </li>
                <li>
                    <a href="https://github.com/acmephp/acmephp">
                        Github
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<main class="doc-page">
    <div class="container">
        <div class="doc-menu">
            <nav role="navigation">
                <ul class="doc-menu-list">
                                        <li>
                        <h4 class="doc-menu-header">Getting started</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/getting-started/1-installation.html">
                                        1. Installation
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/getting-started/2-obtain-certificate-easy.html">
                                        2. Obtain a certificate
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/getting-started/3-configure-webserver.html">
                                        3. Configure your webserver
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/getting-started/4-automatic-renewal.html">
                                        4. Setup automatic renewal
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">Guides</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/guides/multidomain-certificates.html">
                                        Multi-domain certificates
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/guides/dns-challenge.html">
                                        Prove you own a domain using DNS
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">ACME protocol implementation</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/core/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="current">
                                    <a href="/core/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">SSL library</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/ssl/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/ssl/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    </ul>
            </nav>
        </div>

        <div class="doc-content">
            <div class="doc-edit">
                <a href="https://github.com/acmephp/documentation">
                    <i class="fa fa-github"></i>
                    <span>Edit on Github</span>
                </a>
            </div>

            <h1 id="get-started">Get started</h1>
<h2 id="installation">Installation</h2>
<p>You will need the PHP OpenSSL extension to use Acme PHP Core.</p>
<p>Install this library using Composer:</p>
<pre><code>composer require acmephp/core</code></pre>
<h2 id="usage">Usage</h2>
<h3 id="1-create-a-secure-http-client">1. Create a secure HTTP client</h3>
<p>A SecureHttpClient is a Guzzle HTTP client wrapper to send requests signed with the account KeyPair.</p>
<pre><code class="language-php">&lt;?php

use AcmePhp\Core\Http\Base64SafeEncoder;
use AcmePhp\Core\Http\SecureHttpClientFactory;
use AcmePhp\Core\Http\ServerErrorHandler;
use AcmePhp\Ssl\KeyPair;
use AcmePhp\Ssl\PrivateKey;
use AcmePhp\Ssl\PublicKey;
use AcmePhp\Ssl\Parser\KeyParser;
use AcmePhp\Ssl\Signer\DataSigner;
use GuzzleHttp\Client as GuzzleHttpClient;

$secureHttpClientFactory = new SecureHttpClientFactory(
    new GuzzleHttpClient(),
    new Base64SafeEncoder(),
    new KeyParser(),
    new DataSigner(),
    new ServerErrorHandler()
);

// $accountKeyPair instance of KeyPair
$secureHttpClient = $secureHttpClientFactory-&gt;createSecureHttpClient($accountKeyPair);

// See AcmePhp\Core\Http\SecureHttpClient for all available methods.</code></pre>
<h3 id="generate-a-key-pair-if-needed">Generate a key pair if needed</h3>
<p>If you don't already have a KeyPair, you can generate one:</p>
<pre><code class="language-php">&lt;?php

use AcmePhp\Ssl\Generator\KeyPairGenerator;

$publicKeyPath = '/custom/path/to/keys/account.pub.pem';
$privateKeyPath = '/custom/path/to/keys/account.pem';

if (!file_exists($privateKeyPath)) {
    $keyPairGenerator = new KeyPairGenerator();
    $keyPair = $keyPairGenerator-&gt;generateKeyPair();

    file_put_contents($publicKeyPath, $keyPair-&gt;getPublicKey()-&gt;getPEM());
    file_put_contents($privateKeyPath, $keyPair-&gt;getPrivateKey()-&gt;getPEM());
} else {
    $publicKey = new PublicKey(file_get_contents($publicKeyPath));
    $privateKey = new PrivateKey(file_get_contents($privateKeyPath));

    $keyPair = new KeyPair($publicKey, $privateKey);
}</code></pre>
<h3 id="set-up-the-acme-client">Set up the ACME client</h3>
<pre><code class="language-php">&lt;?php

use AcmePhp\Core\AcmeClient;

$secureHttpClient = $secureHttpClientFactory-&gt;createSecureHttpClient($keyPair);

// Important, change to production LE directory for real certs!
$acmeClient = new AcmeClient($secureHttpClient, 'https://acme-staging-v02.api.letsencrypt.org/directory');</code></pre>
<p>See <code>AcmePhp\Core\AcmeClientInterface</code> and <code>AcmePhp\Core\AcmeClientV2Interface</code> for detailed
explainations of each methods of the client.</p>
<h3 id="create-new-account">Create new account</h3>
<pre><code class="language-php">&lt;?php

// registerAccount($agreement = null, $email = null)
$acmeClient-&gt;registerAccount(null, 'testing@tester.com');</code></pre>
<h3 id="request-authorization">Request authorization</h3>
<pre><code class="language-php">&lt;?php

// This will return a list of challenges that you can use to prove you own the domain.
$authorizationChallenges = $acmeClient-&gt;requestAuthorization('mydomain.com');
var_dump($authorizationChallenges);

// You need to stage  your challenge response via DNS or HTTP before making the next call:
// $acmeClient-&gt;challengeAuthorization($authorizationChallenges[0])</code></pre>
<h3 id="generate-csr-and-private-key">Generate CSR and private key</h3>
<pre><code class="language-php">&lt;?php

use AcmePhp\Ssl\CertificateRequest;
use AcmePhp\Ssl\DistinguishedName;

$dn = new DistinguishedName('mydomain.com');

$keyPairGenerator = new KeyPairGenerator();

// Make a new key pair. We'll keep the private key as our cert key
$domainKeyPair = $keyPairGenerator-&gt;generateKeyPair();

// This is the private key
var_dump($domainKeyPair-&gt;getPrivateKey()-&gt;getPem());

// Generate CSR
$csr = new CertificateRequest($dn, $domainKeyPair);</code></pre>
<h3 id="request-certificate">Request certificate</h3>
<pre><code class="language-php">&lt;?php

$certificateResponse = $acmeClient-&gt;requestCertificate('mydomain.com', $csr);

// This is the certificate (public key)
var_dump($certificateResponse-&gt;getCertificate()-&gt;getPem());

// For Let's Encrypt, you will need the intermediate too
var_dump($certificateResponse-&gt;getCertificate()-&gt;getIssuerCertificate()-&gt;getPEM());</code></pre>
        </div>

        <div class="clearfix"></div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <nav>
            <ul>
                <li class="footer-column">
                    <h5>
                        Documentation
                    </h5>

                    <ul>
                        <li>
                            <a href="/documentation/">Command line tool</a>
                        </li>
                        <li>
                            <a href="/documentation/core/introduction.html">Acme PHP library</a>
                        </li>
                        <li>
                            <a href="/documentation/ssl/introduction.html">SSL library</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Contribute
                    </h5>

                    <ul>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github repository</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp/issues">Issues tracker</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/documentation">Improve documentation</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Connect
                    </h5>

                    <ul>
                        <li>
                            <a href="https://gitter.im/acmephp/acmephp">Gitter</a>
                        </li>
                        <li>
                            <a href="https://twitter.com/acme_php">Twitter</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        About
                    </h5>

                    <ul>
                        <li>
                            © 2016 Titouan Galopin. All Rights Reserved.
                        </li>
                        <li>
                            Acme PHP is built by
                            <a href="https://twitter.com/titouangalopin">@tgalopin</a> and
                            <a href="https://twitter.com/jderusse">@jderusse</a>
                        </li>
                        <li>
                            Acme PHP source code and documentation are free and open-source under the
                            MIT license
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="clearfix"></div>
    </div>
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-79502600-1', 'auto');
    ga('send', 'pageview');

    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:233364,hjsv:5};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script>
        <!-- Livereload -->
        <script>
            document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
                    ':35729/livereload.js?snipver=1"></' + 'script>')
        </script>
        <!-- End Livereload -->
    </body>
</html>
