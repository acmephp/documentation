<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Acme PHP | Documentation</title>

    <link href="/fonts/fonts.css" rel="stylesheet">
    <link href="/icons/css/font-awesome.min.css" rel="stylesheet">
    <link href="/min/app.css" rel="stylesheet">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<header class="header">
    <div class="container">
        <h1 class="header-title">
            <a href="/">Acme PHP</a>
        </h1>

        <nav class="header-menu">
            <ul>
                <li class="current">
                    <a href="/documentation/">
                        Documentation
                    </a>
                </li>
                <li>
                    <a href="https://github.com/acmephp/acmephp">
                        Github
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<main class="doc-page">
    <div class="container">
        <div class="doc-menu">
            <nav role="navigation">
                <ul class="doc-menu-list">
                                        <li>
                        <h4 class="doc-menu-header">Getting started</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/getting-started/1-installation.html">
                                        1. Installation
                                    </a>
                                </li>
                                                            <li class="current">
                                    <a href="/getting-started/2-obtain-certificate-easy.html">
                                        2. Obtain a certificate
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/getting-started/3-configure-webserver.html">
                                        3. Configure your webserver
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/getting-started/4-automatic-renewal.html">
                                        4. Setup automatic renewal
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">Guides</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/guides/multidomain-certificates.html">
                                        Multi-domain certificates
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/guides/dns-challenge.html">
                                        Prove you own a domain using DNS
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">ACME protocol implementation</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/core/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/core/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                        <li>
                        <h4 class="doc-menu-header">SSL library</h4>

                        <ul class="doc-menu-sub">
                                                            <li class="">
                                    <a href="/ssl/introduction.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="/ssl/get-started.html">
                                        Get started
                                    </a>
                                </li>
                                                    </ul>
                    </li>
                                    </ul>
            </nav>
        </div>

        <div class="doc-content">
            <div class="doc-edit">
                <a href="https://github.com/acmephp/documentation">
                    <i class="fa fa-github"></i>
                    <span>Edit on Github</span>
                </a>
            </div>

            <h1 id="obtain-a-certificate">Obtain a certificate</h1>
<p>Now Acme PHP is available on your system (<code>php acmephp.phar --version</code> should display its version),
you can start requesting certificates for your domains using it.</p>
<p><strong>Note:</strong> This is the long way to abtain a certificate. The
<a href="/documentation/getting-started/2-obtain-certificate-easy.html">recommended way describe here</a></p>
<p>Several steps are required to do so (note that only the 4th one will be necessary during renewal):</p>
<ol>
<li><a href="#1-register-on-the-lets-encryptacme-server">Register on the Let's Encrypt/ACME server</a></li>
<li><a href="#2-prove-you-own-the-domain">Prove you own the domain</a></li>
<li><a href="#3-ask-the-server-to-check-your-proof">Ask the server to check your proof</a></li>
<li><a href="#4-get-your-certificate">Get your certificate</a></li>
<li><a href="#5-renew-your-certificate">Renew your certificate</a></li>
<li><a href="#6-list-the-certificates-handled-by-acme-php">List the certificates handled by Acme PHP</a></li>
</ol>
<h2 id="1-register-on-the-lets-encryptacme-server">1. Register on the Let's Encrypt/ACME server</h2>
<p>The first thing we need to do is to generate a global private key (your &quot;account key&quot;) that will be
used for future exchanges with Let's Encrypt to prove your identity.</p>
<p>To do so, run the following command:</p>
<pre><code class="language-console">php acmephp.phar register youremail@example.com</code></pre>
<p>This command will do three main things:</p>
<ul>
<li>create a default configuration file <code>~/.acmephp/acmephp.conf</code> that you may edit for advanced usages of Acme PHP</li>
<li>generate a key pair for your account and store it in <code>~/.acmephp/master/account</code></li>
<li>register your account key in the Let's Encrypt/ACME server, associating it with your e-mail address</li>
</ul>
<h2 id="2-prove-you-own-the-domain">2. Prove you own the domain</h2>
<p>You can only request certificates for domains you own so you need to prove to the Let's Encrypt server that you own
the domain.</p>
<p>The principle is quite simple:</p>
<ul>
<li>You ask the server for a token and expose it on a specific URL given by the server</li>
<li>The server check that URL and verify the token is properly exposed there</li>
</ul>
<p><strong>Note:</strong> This technique is called HTTP checking as it uses a HTTP request to check your ownership.
You can also use <a href="/documentation/guides/dns-challenge.html">DNS checking</a> which uses a DNS TXT field to expose the token
(it may be easier in your specific context).</p>
<p>Using this technique, you proved your server is responding behind the concerned domain.</p>
<p><strong>Note:</strong> You'll need to periodically prove that you own a domain (certificates renewals may require a new token).</p>
<p>The first step is to get and expose the token. Run the following:</p>
<pre><code class="language-console"># Get a token to expose
php acmephp.phar authorize yourdomain.org

# The command will display explainations to help you expose the token properly.
# Usually, a simple text file is enough to expose the token.</code></pre>
<h2 id="3-ask-the-server-to-check-your-proof">3. Ask the server to check your proof</h2>
<p>Once the token exposed (don't hesitate to check in your browser), run the following command to ask the server
to check your proof:</p>
<pre><code class="language-console">php acmephp.phar check yourdomain.org

# The server will check the URL for the token to expose. If it succeeds, you will be able to request certificate
# for this domain.</code></pre>
<p>If there is an issue, you will usually have a message describing the problem. If you are stuck, don't hesitate to
ask on <a href="https://github.com/acmephp/acmephp/issues">Github issues</a>.</p>
<h2 id="4-get-your-certificate">4. Get your certificate</h2>
<p>Finally! You are the proved owner of your domain, you can now request and renew a certificate for this domain.
To do so, simply run the <code>request</code> command:</p>
<pre><code class="language-console">php acmephp.phar request yourdomain.org</code></pre>
<p>This command will ask you required informations for the certificate, request it to the server and store it in
the <code>~/.acmephp</code> storage directory.</p>
<p>6 files will be created in the storage directory:</p>
<ul>
<li>
<p><strong>The full-chain certificate</strong> at <code>~/.acmephp/master/certs/yourdomain.org/fullchain.pem</code>.
This file is the certificate itself. You probably want to use this file in your webserver configuration as it
includes all the issuers chain for a better compatibility with old devices.</p>
</li>
<li>
<p><strong>The certificate private key</strong> at <code>~/.acmephp/master/private/yourdomain.org/private.pem</code>.
This file is usually required by the webserver.</p>
</li>
<li>
<p><strong>The chain alone</strong> at <code>~/.acmephp/master/certs/yourdomain.org/chain.pem</code>.
Some webservers requires a separated chain and certificate. This is the chain part, if you need it.</p>
</li>
<li>
<p><strong>The certificate alone</strong> at <code>~/.acmephp/master/certs/yourdomain.org/cert.pem</code>.
Some webservers requires a separated chain and certificate. This is the certificate part, if you need it.</p>
</li>
<li>
<p><strong>The combined certificate</strong> at <code>~/.acmephp/master/certs/yourdomain.org/combined.pem</code>.
Some webservers requires a single file combining the full-chain and the certificate private key.
This is it, if you need it.</p>
</li>
<li>
<p><strong>The certificate public key</strong> at <code>~/.acmephp/master/private/yourdomain.org/public.pem</code>.
You probably won't need it, but it's still available here.</p>
</li>
</ul>
<p>You can now <a href="/documentation/getting-started/3-configure-webserver.html">configure your webserver</a>!</p>
<h2 id="5-renew-your-certificate">5. Renew your certificate</h2>
<p>If a certificate will expire soon, you will probably want to renew it. To do so, simply rerun the <code>request</code> command:</p>
<pre><code class="language-console">php acmephp.phar request yourdomain.org</code></pre>
<p>This time, the command won't ask you anything (all the required informations were stored at the first request).
The certificate will be renewed.</p>
<p>Please note that there may be a limit of renewals per day or week depending on the configuration of the ACME server.
Let's Encrypt has this kind of limitation: renew only when required (one week before expiration for instance).</p>
<p>By default, the <code>request</code> command won't renew until one week before the expiration of the certificate. Therefore you
can put it as a CRON every day and it will renew only when required.</p>
<h2 id="6-list-the-certificates-handled-by-acme-php">6. List the certificates handled by Acme PHP</h2>
<p>Using the command <code>./acmephp.phar status</code>, you can see what certificates are handled by the Acme PHP client
and when they will expire. It's a useful tool to avoid expired certificates:</p>
<pre><code class="language-console">php acmephp.phar status

+---------------+----------------------------+---------------------+---------------------+----------------+
| Domain        | Issuer                     | Valid from          | Valid to            | Needs renewal? |
+---------------+----------------------------+---------------------+---------------------+----------------+
| acmephp.com   | Let's Encrypt Authority X3 | 2016-06-17 13:08:00 | 2016-09-15 13:08:00 | No             |
+---------------+----------------------------+---------------------+---------------------+----------------+</code></pre>
<hr />
<p>Next: <a href="/documentation/getting-started/3-configure-webserver.html">Configure your webserver</a></p>
        </div>

        <div class="clearfix"></div>
    </div>
</main>

<footer class="footer">
    <div class="container">
        <nav>
            <ul>
                <li class="footer-column">
                    <h5>
                        Documentation
                    </h5>

                    <ul>
                        <li>
                            <a href="/documentation/">Command line tool</a>
                        </li>
                        <li>
                            <a href="/documentation/core/introduction.html">Acme PHP library</a>
                        </li>
                        <li>
                            <a href="/documentation/ssl/introduction.html">SSL library</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Contribute
                    </h5>

                    <ul>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github repository</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp/issues">Issues tracker</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/documentation">Improve documentation</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        Connect
                    </h5>

                    <ul>
                        <li>
                            <a href="https://gitter.im/acmephp/acmephp">Gitter</a>
                        </li>
                        <li>
                            <a href="https://twitter.com/acme_php">Twitter</a>
                        </li>
                        <li>
                            <a href="https://github.com/acmephp/acmephp">Github</a>
                        </li>
                    </ul>
                </li>
                <li class="footer-column">
                    <h5>
                        About
                    </h5>

                    <ul>
                        <li>
                            © 2016 Titouan Galopin. All Rights Reserved.
                        </li>
                        <li>
                            Acme PHP is built by
                            <a href="https://twitter.com/titouangalopin">@tgalopin</a> and
                            <a href="https://twitter.com/jderusse">@jderusse</a>
                        </li>
                        <li>
                            Acme PHP source code and documentation are free and open-source under the
                            MIT license
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="clearfix"></div>
    </div>
</footer>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-79502600-1', 'auto');
    ga('send', 'pageview');

    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:233364,hjsv:5};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script>
        <!-- Livereload -->
        <script>
            document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
                    ':35729/livereload.js?snipver=1"></' + 'script>')
        </script>
        <!-- End Livereload -->
    </body>
</html>
